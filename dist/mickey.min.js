(function(f,a){"object"===typeof exports&&"object"===typeof module?module.exports=a():"function"===typeof define&&define.amd?define(a):"object"===typeof exports?exports.Mickey=a():f.Mickey=a()})(this,function(){return function(f){function a(e){if(m[e])return m[e].exports;var d=m[e]={exports:{},id:e,loaded:!1};f[e].call(d.exports,d,d.exports,a);d.loaded=!0;return d.exports}var m={};a.m=f;a.c=m;a.p="";return a(0)}([function(f,a,m){function e(g){var a=function(a){a=D[a.keyCode];"click"===a?g.click():
a&&g.move(a)};return{bind:function(){document.addEventListener("keydown",a)},unbind:function(){document.removeEventListener("keydown",a)}}}function d(a,g,k){return function(e){return e.hasAttribute(k+a)?g:0}}var p=m(3);a=m(2);var g=a.Box,k=a.createBox;a=m(4);var n=a.$first,t=a.$find,u=a.$rmvClass,y=a.$addClass;a=m(1);var M=a.dot,N=a.vec,O=a.opp,E=a.nil,P=a.dist1,Q=a.distp,R=a.axisReflect,S=a.pointReflect,z={left:{x:-1,y:0},up:{x:0,y:-1},right:{x:1,y:0},down:{x:0,y:1}},D={37:"left",38:"up",39:"right",
40:"down",13:"click"},T={left:"left",up:"top",right:"right",down:"bottom"},U={left:"horizontal",right:"horizontal",up:"vertical",down:"vertical"};f.exports=function(a,h){function f(c,a){if(c){var g=document.createEvent("MouseEvents"),k=b.pos.x,e=b.pos.y;g.initMouseEvent(a,!0,!0,window,0,k,e,k,e,!1,!1,!1,!1,0,null);c.dispatchEvent(g)}}function m(c){return!!c&&(c.hasAttribute(l+"area")||c===a)}function A(c){return!!c&&c.hasAttribute(l+"limit")}function F(c){return!!c&&c.hasAttribute(l+"track")}function B(c,
b){return!!b&&A(c)&&c.getAttribute(l+"limit")===T[b]}function D(c){return!!c&&c.hasAttribute(l+"selected")}function q(c,b,a,e){var d=a?z[a]:E(),n=O(d),f=c._r;c instanceof g&&(c=c.bound(d));b=_.map(b,k);b=_.filter(b,function(b){if(!b)return!1;b=e?b.bound(n):b.center();b=N(c,b);return M(b,d)>=-h.overlap});b=_.sortByAll(_.map(b,function(b){var a=b.bound(n),g={el:b.el,proj:Q(c,b.bound(n),d),dist:P(c,a),priority:Infinity},k;(k=!f)||(b=b._r,b=0!==d.y?!(b.left>=f.left+f.width||b.left+b.width<=f.left):0!==
d.x?!(b.top>=f.top+f.height||b.top+b.height<=f.top):!1,k=!b);if(k)return g;0!==d.y&&(g.priority=a.x*G);0!==d.x&&(g.priority=a.y*H);return g}),["proj","priority","dist"]);1<b.length&&_.find(b,function(b){return Infinity>b.priority})&&(b=_.filter(b,function(b){return Infinity>b.priority}));return b[0]&&b[0].el}function C(){var b=t(a,h.$area);return b.length?b:[a]}function J(){var b=C();_.some(b,D)&&(b=_.sortBy(b,V));return _.first(b)}function r(b,a){var g=t(b,b.getAttribute(l+"area")||h.$href),k=_.some(g,
A);k&&(g=_.sortBy(g,W));return k&&a?_.filter(g,function(b){return!A(b)||B(b,a)}):g}function K(c){return b.focus(b.closest()||J(),c,!0)}if(!a)throw Error("mickey: should pass a parent DOM element");var v=!1,w=!1;h=_.defaults(h||{},{changeClass:!0,hoverClass:"hover",areaClass:"hover",trackClass:"tracked",onChangeArea:_.noop,onChangeSelected:_.noop,overlap:0,position:null,priority:"left,top",listener:e,observer:p,prefix:"data-nav-",$area:"[data-nav-area]",$href:null});var l=h.prefix,H=0,G=0;_.contains(h.priority,
"left")&&(G=1);_.contains(h.priority,"right")&&(G=-1);_.contains(h.priority,"top")&&(H=1);_.contains(h.priority,"bottom")&&(H=-1);var W=d("limit",1,l),V=d("selected",-1,l),b={version:"1.0.5",pos:h.position||E(),el:null,ar:null},x=h.listener(b),I,L=_.once(function(){I=h.observer(a,X);x.bind&&x.bind(a)}),Y=_.once(function(){I&&I.disconnect();x.unbind&&x.unbind()});b.focus=function(c,g,d){_.isString(c)&&(c=a.querySelector(c));if(m(c))return b.focus(b.defaults(c));var e=k(c);if(!e)return!1;var n=c,t=
b.area(n),p=b.el,l=b.ar,q=A(n),r=t!==l;r&&(b.ar=t,h.changeClass&&(u(l,h.areaClass),y(t,h.areaClass)));n===p||t===l&&q&&!d||(b.pos=e.center(),b.el=n,h.changeClass&&(u(p,h.hoverClass),y(p,h.trackClass,r&&F(l))),f(p,"mouseout"),f(n,"mouseover"));h.changeClass&&(u(n,h.trackClass),y(n,h.hoverClass,!q));q&&B(n,g)&&b.click(c);if(b.ar!==l)h.onChangeArea(l,b.ar);if(b.el!==p)h.onChangeSelected(p,b.el,b.ar);w||(L(),w=!0);return!0};b.position=function(){return{x:b.pos.x,y:b.pos.y}};b.move=function(c){if(v)console.warn("mickey: locked");
else{var a=b.el,g=k(a);if(g){var e=b.area(),a=_.without(r(e,c),a);if(g=q(g,a,c))return b.focus(g,c);if(!(0<+e.getAttribute(l+"z-index"))){e&&e.hasAttribute(l+"circular")?(a=e.getAttribute(l+"circular"),a=""===a||U[c]===a):a=!1;if(a)return b.focus(b.circular(c));var a=k(e),d=_.without(C(),e),a=q(a,d,c,!0);if(!a)return B(b.el,c)?b.click():!1;d=r(a);if(1===d.length&&B(d[0],c))return b.click(d[0]);F(e)&&e.setAttribute(l+"track-pos",JSON.stringify(b.pos));F(a)&&(e=a.getAttribute(l+"track-pos"),g=n(a,"."+
h.trackClass)||e&&q(JSON.parse(e),d));return b.focus(g||d[0],c)}}else K(c)||console.warn("mickey: cannot move")}};b.click=function(c){if(v||!w)console.warn("mickey: locked");else if(c=c||b.el,a.contains(c,z)){if(c||K())return f(c,"click"),!0;console.warn("mickey: cannot click")}else console.warn("mickey: cannot click on non visible element")};b.area=function(c){for(c=c||b.el;c&&c!==a;)if(c=c.parentNode,m(c))return c;return a};b.closest=function(a){a=_.flatten(_.map(a?[a]:C(),r));return q(b.pos,a)};
b.closestInArea=function(){return b.closest(b.ar)};b.defaults=function(b){return r(b||J())[0]};b.defaultsInArea=function(){return b.defaults(b.ar)};b.hovered=function(){var a=_.flatten(_.map(C(),r)),g;g=b.pos;g=(a=k(q(g,a)))&&a.contains(g,z)?a.el:void 0;return g};b.circular=function(a){var g;g=k(b.ar).center();g=a?R(k(b.el),a,g):S(b.pos,g);return q(g,r(b.ar),a)};b.block=function(){v=!0;h.changeClass&&y(b.el,"blocked")};b.unblock=function(){v=!1;h.changeClass&&u(b.el,"blocked")};b.clear=_.once(function(){Y();
b.pos=E();b.el=null;a=b.ar=null;v=!1;x=null});b.update=function(){b.focus(b.closest())};b.init=function(){if(w)console.warn("mickey: already initialized");else return L(),b.focus(h.position?b.hovered():b.defaults()),b};var X=function(){if(!w)return b.init();if(a&&!a.contains(b.el,z)){var g;switch(b.ar.getAttribute(l+"policy")){default:case "closest":g=b.closestInArea();break;case "defaults":g=b.defaultsInArea();break;case "hovered":g=b.hovered();break;case "circular":g=b.circular()}b.focus(g,null,
!0)}};return b}},function(f,a,m){function e(a,e){return{x:e.x-a.x,y:e.y-a.y}}function d(a){return Math.abs(a.x)+Math.abs(a.y)}function p(a,e){return a.x*e.x+a.y*e.y}f.exports={nil:function(){return{x:0,y:0}},vec:e,dist1:function(a,k){return d(e(a,k))},distp:function(a,k,n){a=e(a,k);a=p(a,n);return d({x:a*n.x,y:a*n.y})},norm1:d,opp:function(a){return{x:-a.x,y:-a.y}},dot:p,pointReflect:function(a,e){return{x:2*e.x-a.x,y:2*e.y-a.y}},axisReflect:function(a,e,d){var f=_.extend({},a._r);switch(e){case "up":f.top+=
2*d.y;break;case "down":f.top-=2*d.y;break;case "left":f.left+=2*d.x;break;case "right":f.left-=2*d.x}a._r=f;return a}}},function(f,a,m){function e(a,e){this.el=a;this._r=e}a=m(1);var d=a.vec,p=a.dot;e.prototype.contains=function(a,e){var f=this.center(),m=d(f,this.bound(e.down)),u=d(f,this.bound(e.right)),f=d(f,a);return 2*Math.abs(p(m,f))<=this._r.height&&2*Math.abs(p(u,f))<=this._r.width};e.prototype.center=function(){return{x:this._r.left+this._r.width/2,y:this._r.top+this._r.height/2}};e.prototype.bound=
function(a){return{x:this._r.left+this._r.width*(1+a.x)/2,y:this._r.top+this._r.height*(1+a.y)/2}};f.exports={Box:e,createBox:function(a){if(a){var d=a.getBoundingClientRect(),f=d.height,p=d.width;if(0!==f||0!==p)return new e(a,{height:f,width:p,top:d.top,right:d.right,bottom:d.bottom,left:d.left})}}}},function(f,a,m){f.exports=function(a,d){var f;null!=window.MutationObserver?(f=new MutationObserver(d),f.observe(a,{attributes:!1,childList:!0,characterData:!0,subtree:!0})):(d=_.debounce(d,0),a.addEventListener("DOMSubtreeModified",
d),f={disconnect:function(){a.removeEventListener("DOMSubtreeModified",d)}});return f}},function(f,a,m){f.exports={$first:function(a,d){return a.querySelector(d)},$find:function(a,d){return _.toArray(a.querySelectorAll(d))},$addClass:function(a,d,f){a&&!1!==f&&a.classList.add(d)},$rmvClass:function(a,d,f){a&&!1!==f&&a.classList.remove(d)}}}])});
