!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):"object"==typeof exports?exports.Mickey=e():t.Mickey=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function r(t){var e=function(e){var n=C[e.keyCode];"click"===n?t.click():n&&t.move(n)};return{bind:_.bind(document.addEventListener,document,"keydown",e),unbind:_.bind(document.removeEventListener,document,"keydown",e)}}function o(t,e){return function(n){return n.hasAttribute("data-"+t)?e:0}}function i(t,e){function n(t,e){if(t){var n=document.createEvent("MouseEvents"),r=P.pos.x,o=P.pos.y;n.initMouseEvent(e,!0,!0,window,0,r,o,r,o,!1,!1,!1,!1,0,null),t.dispatchEvent(n)}}function o(e){return!!e&&(e.dataset.hasAttribute("data-nav-area")||e===t)}function i(t){return!!t&&t.dataset.hasAttribute("data-nav-limit")}function u(t){return!!t&&t.dataset.hasAttribute("data-nav-track")}function C(t,e){if(!t||!t.hasAttribute("data-nav-circular"))return!1;var n=t.dataset.navCircular;return""===n||E[e]===n}function B(t,e){return!!e&&i(t)&&t.dataset.navLimit===M[e]}function L(t){return!!t&&t.dataset.hasAttribute("data-nav-selected")}function S(t,n,r,o){var i=r?g[r]:b(),a=y(i);t instanceof c&&(t=t.bound(i));var u=function(n){return h(p(t,n),i)>=-e.overlap},f=_.sortBy(_.map(_.filter(_.map(n,s),function(t){return t&&u(o?t.bound(a):t.center())}),function(e){return{el:e.el,proj:k(t,e.bound(a),i),dist:x(t,e.bound(a))}}),function(t){return t.proj});return f.length>1&&f[0].proj===f[1].proj&&(f=_.sortBy(f,function(t){return t.dist})),f[0]&&f[0].el}function j(t,e){var n=s(S(t,e));return n&&n.contains(t,g)?n.el:void 0}function O(){var n=l(t,e.$area);return n.length?n:[t]}function I(){var t=O();return _.some(t,L)&&(t=_.sortBy(t,$)),_.first(t)}function R(t,n){var r=l(t,t.dataset.navArea||e.$href),o=_.some(r,i);return o&&(r=_.sortBy(r,A)),o&&n?_.filter(r,function(t){return!i(t)||B(t,n)}):r}function D(t){return P.focus(P.closest()||I(),t,!0)}if(!t)throw new Error("mickey: should pass a parent DOM element");var q=!1,z=!1;e=_.defaults(e||{},{hoverClass:"hover",areaClass:"hover",trackClass:"tracked",overlap:0,position:null,listener:r,observer:a,$area:"[data-nav-area]",$href:null});var N,P={version:"1.0.3",pos:e.position||b(),el:null,ar:null},J=e.listener(P),T=_.once(function(){N=e.observer(t,F),J.bind&&J.bind(t)}),Z=_.once(function(){N&&N.disconnect(),J.unbind&&J.unbind()});P.focus=function(r,a,c){if(_.isString(r)&&(r=t.querySelector(r)),o(r))return P.focus(P.defaults(r));var f=s(r);if(!f)return!1;var l=r,h=P.area(l),p=P.el,y=P.ar,b=i(l),x=h!==y;return x&&(P.ar=h,d(y,e.areaClass),v(h,e.areaClass)),l===p||h===y&&b&&!c||(P.pos=f.center(),P.el=l,d(p,e.hoverClass),v(p,e.trackClass,x&&u(y)),n(p,"mouseout"),n(l,"mouseover")),d(l,e.trackClass),v(l,e.hoverClass,!b),b&&B(l,a)&&P.click(r),z||(z=!0),!0},P.position=function(){return{x:P.pos.x,y:P.pos.y}},P.move=function(t){if(q)throw new Error("mickey: locked");var n=P.el,r=s(n);if(r){var o=P.area(),i=_.without(R(o,t),n),a=S(r,i,t);if(a)return P.focus(a,t);var c=+o.dataset.navZIndex;if(!(c>0)){if(C(o,t))return P.focus(P.circular(t));var l=s(o),d=_.without(O(),o),v=S(l,d,t,!0);if(!v)return B(P.el,t)?P.click():!1;var h=R(v);if(1===h.length&&B(h[0],t))return P.click(h[0]);if(u(o)&&(o.dataset.navTrackPos=JSON.stringify(P.pos)),u(v)){var p=v.dataset.navTrackPos,y=f(v,"."+e.trackClass);a=y||p&&S(JSON.parse(p),h)}return P.focus(a||h[0],t)}}else if(!D(t))throw new Error("mickey: cannot move")},P.click=function(e){if(q||!z)throw new Error("mickey: locked");if(e=e||P.el,!t.contains(e,g))throw new Error("mickey: cannot click on non visible element");if(!e&&!D())throw new Error("mickey: cannot click");return n(e,"click"),!0},P.area=function(e){for(e=e||P.el;e&&e!==t;)if(e=e.parentNode,o(e))return e;return t},P.closest=function(t){var e=_.flatten(_.map(t?[t]:O(),R));return S(P.pos,e)},P.closestInArea=function(){return P.closest(P.ar)},P.defaults=function(t){return R(t||I())[0]},P.defaultsInArea=function(){return P.defaults(P.ar)},P.hovered=function(){var t=_.flatten(_.map(O(),R));return j(P.pos,t)},P.circular=function(t){var e,n=s(P.ar).center();return e=t?m(s(P.el).bound(g[t]),n,g[t]):w(P.pos,n),S(e,R(P.ar),t)},P.block=function(){q=!0,v(P.el,"blocked")},P.unblock=function(){q=!1,d(P.el,"blocked")},P.clear=_.once(function(){Z(),P.pos=b(),P.el=null,P.ar=null,t=null,q=!1,J=null}),P.update=function(){P.focus(P.closest())},P.init=function(){if(z)throw new Error("mickey: already initialized");return T(),P.focus(e.position?P.hovered():P.defaults()),P};var F=function(){if(!z)return P.init();if(t&&!t.contains(P.el,g)){var e,n=P.ar;switch(n.dataset.navPolicy){default:case"closest":e=P.closestInArea();break;case"defaults":e=P.defaultsInArea();break;case"hovered":e=P.hovered();break;case"circular":e=P.circular()}P.focus(e,null,!0)}};return P}var a=n(3),u=n(2),c=u.Box,s=u.createBox,u=n(4),f=u.$first,l=u.$find,d=u.$rmvClass,v=u.$addClass,u=n(1),h=u.dot,p=u.vec,y=u.opp,b=u.nil,x=u.dist1,k=u.distp,m=u.axisReflect,w=u.pointReflect,g={left:{x:-1,y:0},up:{x:0,y:-1},right:{x:1,y:0},down:{x:0,y:1}},C={37:"left",38:"up",39:"right",40:"down",13:"click"},M={left:"left",up:"top",right:"right",down:"bottom"},E={left:"horizontal",right:"horizontal",up:"vertical",down:"vertical"},A=o("nav-limit",1),$=o("nav-selected",-1);t.exports=i},function(t){"use strict";function e(){return{x:0,y:0}}function n(t,e){return{x:e.x-t.x,y:e.y-t.y}}function r(t,e){return i(n(t,e))}function o(t,e,r){return i(f(n(t,e),r))}function i(t){return Math.abs(t.x)+Math.abs(t.y)}function a(t){return{x:-t.x,y:-t.y}}function u(t,e){return t.x*e.x+t.y*e.y}function c(t,e){return{x:2*e.x-t.x,y:2*e.y-t.y}}function s(t,e,n){return{x:t.x+2*(e.x-t.x)*Math.abs(n.x),y:t.y+2*(e.y-t.y)*Math.abs(n.y)}}function f(t,e){var n=u(t,e);return{x:n*e.x,y:n*e.y}}t.exports={nil:e,vec:n,dist1:r,distp:o,norm1:i,opp:a,dot:u,pointReflect:c,axisReflect:s}},function(t,e,n){"use strict";function r(t){if(t){var e=t.getBoundingClientRect();return e.height>0||e.width>0?new o(t,e):void 0}}function o(t,e){this.el=t,this._r=e}var i=n(1),a=i.vec,u=i.dot;o.prototype.contains=function(t,e){var n=this.center(),r=a(n,this.bound(e.down)),o=a(n,this.bound(e.right)),i=a(n,t);return 2*Math.abs(u(r,i))<=this._r.height&&2*Math.abs(u(o,i))<=this._r.width},o.prototype.center=function(){return{x:this._r.left+this._r.width/2,y:this._r.top+this._r.height/2}},o.prototype.bound=function(t){return{x:this._r.left+this._r.width*(1+t.x)/2,y:this._r.top+this._r.height*(1+t.y)/2}},t.exports={Box:o,createBox:r}},function(t){"use strict";t.exports=function(t,e){var n;return null!=window.MutationObserver?(n=new MutationObserver(e),n.observe(t,{attributes:!1,childList:!0,characterData:!0,subtree:!0})):(e=_.debounce(e,0),t.addEventListener("DOMSubtreeModified",e),n={disconnect:function(){t.removeEventListener("DOMSubtreeModified",e)}}),n}},function(t){"use strict";function e(t,e){return t.querySelector(e)}function n(t,e){return _.toArray(t.querySelectorAll(e))}function r(t,e,n){t&&n!==!1&&t.classList.add(e)}function o(t,e,n){t&&n!==!1&&t.classList.remove(e)}t.exports={$first:e,$find:n,$addClass:r,$rmvClass:o}}])});