!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):"object"==typeof exports?exports.Mickey=e():t.Mickey=e()}(this,function(){return function(t){function e(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return t[n].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){"use strict";function n(t){var e=function(e){var r=C[e.keyCode];"click"===r?t.click():r&&t.move(r)};return{bind:_.bind(document.addEventListener,document,"keydown",e),unbind:_.bind(document.removeEventListener,document,"keydown",e)}}function i(t,e,r){return function(n){return n.hasAttribute(r+t)?e:0}}var o=r(2)["default"],u=r(4).DOMObserver,c=r(3),a=c.Box,s=c.createBox,f=r(5),l=f.$first,d=f.$find,p=f.$rmvClass,v=f.$addClass,h=r(1),y=h.dot,b=h.vec,x=h.opp,m=h.nil,w=h.dist1,k=h.distp,g=h.axisReflect,M=h.pointReflect,A={left:{x:-1,y:0},up:{x:0,y:-1},right:{x:1,y:0},down:{x:0,y:1}},C={37:"left",38:"up",39:"right",40:"down",13:"click"},E={left:"left",up:"top",right:"right",down:"bottom"},O={left:"horizontal",right:"horizontal",up:"vertical",down:"vertical"},$=function j(t,e){function r(t,e){if(t){var r=document.createEvent("MouseEvents"),n=G.pos.x,i=G.pos.y;r.initMouseEvent(e,!0,!0,window,0,n,i,n,i,!1,!1,!1,!1,0,null),t.dispatchEvent(r)}}function c(r){return!!r&&(r.hasAttribute(e.prefix+"area")||r===t)}function f(t){return!!t&&t.hasAttribute(e.prefix+"limit")}function h(t){return!!t&&t.hasAttribute(e.prefix+"track")}function C(t,r){if(!t||!t.hasAttribute(e.prefix+"circular"))return!1;var n=t.getAttribute(e.prefix+"circular");return""===n||O[r]===n}function $(t,r){return!!r&&f(t)&&t.getAttribute(e.prefix+"limit")===E[r]}function B(t){return!!t&&t.hasAttribute(e.prefix+"selected")}function S(t,e,r){return 0!==r.y?!(e.left>=t.left+t.width||e.left+e.width<=t.left):0!==r.x?!(e.top>=t.top+t.height||e.top+e.height<=t.top):!1}function L(t,r,n,i){var o=n?A[n]:m(),u=x(o),c=t._r;t instanceof a&&(t=t.bound(o));var f=function(e){return y(b(t,e),o)>=0},l=_.sortBy(_.map(_.filter(_.map(r,function(t){return s(t,e.overlap)}),function(t){return t&&f(i?t.bound(u):t.center())}),function(r){var n=r.bound(u),i={el:r.el,proj:k(t,r.bound(u),o),dist:w(t,n),priority:1/0};return c&&S(c,r._r,o)?(0!==o.y&&(_.contains(e.priority,"left")&&(i.priority=n.x),_.contains(e.priority,"right")&&(i.priority=-n.x)),0!==o.x&&(_.contains(e.priority,"top")&&(i.priority=n.y),_.contains(e.priority,"bottom")&&(i.priority=-n.y)),i):i}),["proj","priority","dist"]);return l.length>1&&_.find(l,function(t){return t.priority<1/0})&&(l=_.filter(l,function(t){return t.priority<1/0})),l[0]&&l[0].el}function D(t,r){var n=s(L(t,r),e.overlap);return n&&n.contains(t,A)?n.el:void 0}function P(){var r=d(t,e.$area);return r.length?r:[t]}function R(){var t=P();return _.some(t,B)&&(t=_.sortBy(t,F)),_.first(t)}function q(t,r){var n=d(t,t.getAttribute(e.prefix+"area")||e.$href),i=_.some(n,f);return i&&(n=_.sortBy(n,T)),i&&r?_.filter(n,function(t){return!f(t)||$(t,r)}):n}function z(t){return G.focus(G.closest()||R(),t,!0)}if(o(this,j),!t)throw new Error("mickey: should pass a parent DOM element");var I=!1,N=!1;e=_.defaults(e||{},{hoverClass:"hover",areaClass:"hover",trackClass:"tracked",overlap:0,position:null,priority:"left,top",listener:n,observer:u,prefix:"data-nav-",$area:"[data-nav-area]",$href:null});var J,T=i("limit",1,e.prefix),F=i("selected",-1,e.prefix),G={version:"1.0.6",pos:e.position||m(),el:null,ar:null},H=e.listener(G),K=_.once(function(){J=e.observer(t,U),H.bind&&H.bind(t)}),Q=_.once(function(){J&&J.disconnect(),H.unbind&&H.unbind()});G.focus=function(n,i,o){if(_.isString(n)&&(n=t.querySelector(n)),c(n))return G.focus(G.defaults(n));var u=s(n,e.overlap);if(!u)return!1;var a=n,l=G.area(a),d=G.el,y=G.ar,b=f(a),x=l!==y;return x&&(G.ar=l,p(y,e.areaClass),v(l,e.areaClass)),a===d||l===y&&b&&!o||(G.pos=u.center(),G.el=a,p(d,e.hoverClass),v(d,e.trackClass,x&&h(y)),r(d,"mouseout"),r(a,"mouseover")),p(a,e.trackClass),v(a,e.hoverClass,!b),b&&$(a,i)&&G.click(n),N||(N=!0),!0},G.position=function(){return{x:G.pos.x,y:G.pos.y}},G.move=function(t){if(I)throw new Error("mickey: locked");var r=G.el,n=s(r,e.overlap);if(n){var i=G.area(),o=_.without(q(i,t),r),u=L(n,o,t);if(u)return G.focus(u,t);var c=+i.getAttribute(e.prefix+"z-index");if(!(c>0)){if(C(i,t))return G.focus(G.circular(t));var a=s(i,e.overlap),f=_.without(P(),i),d=L(a,f,t,!0);if(!d)return $(G.el,t)?G.click():!1;var p=q(d);if(1===p.length&&$(p[0],t))return G.click(p[0]);if(h(i)&&i.setAttribute(e.prefix+"track-pos",JSON.stringify(G.pos)),h(d)){var v=d.getAttribute(e.prefix+"track-pos"),y=l(d,"."+e.trackClass);u=y||v&&L(JSON.parse(v),p)}return G.focus(u||p[0],t)}}else if(!z(t))throw new Error("mickey: cannot move")},G.click=function(e){if(I||!N)throw new Error("mickey: locked");if(e=e||G.el,!t.contains(e,A))throw new Error("mickey: cannot click on non visible element");if(!e&&!z())throw new Error("mickey: cannot click");return r(e,"click"),!0},G.area=function(e){for(e=e||G.el;e&&e!==t;)if(e=e.parentNode,c(e))return e;return t},G.closest=function(t){var e=_.flatten(_.map(t?[t]:P(),q));return L(G.pos,e)},G.closestInArea=function(){return G.closest(G.ar)},G.defaults=function(t){return q(t||R())[0]},G.defaultsInArea=function(){return G.defaults(G.ar)},G.hovered=function(){var t=_.flatten(_.map(P(),q));return D(G.pos,t)},G.circular=function(t){var r,n=s(G.ar,e.overlap).center();return r=t?g(s(G.el,e.overlap),t,n):M(G.pos,n),L(r,q(G.ar),t)},G.block=function(){I=!0,v(G.el,"blocked")},G.unblock=function(){I=!1,p(G.el,"blocked")},G.clear=_.once(function(){Q(),G.pos=m(),G.el=null,G.ar=null,t=null,I=!1,H=null}),G.update=function(){G.focus(G.closest())},G.init=function(){if(N)throw new Error("mickey: already initialized");return K(),G.focus(e.position?G.hovered():G.defaults()),G};var U=function(){if(!N)return G.init();if(t&&!t.contains(G.el,A)){var r,n=G.ar;switch(n.getAttribute(e.prefix+"policy")){default:case"closest":r=G.closestInArea();break;case"defaults":r=G.defaultsInArea();break;case"hovered":r=G.hovered();break;case"circular":r=G.circular()}G.focus(r,null,!0)}};return G};t.exports=$},function(t,e,r){"use strict";function n(){return{x:0,y:0}}function i(t,e){return{x:e.x-t.x,y:e.y-t.y}}function o(t,e){return a(i(t,e))}function u(t,e,r){return c(p(i(t,e),r))}function c(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function a(t){return Math.abs(t.x)+Math.abs(t.y)}function s(t){return{x:-t.x,y:-t.y}}function f(t,e){return t.x*e.x+t.y*e.y}function l(t,e){return{x:2*e.x-t.x,y:2*e.y-t.y}}function d(t,e,r){switch(e){case"up":t._r.top=t._r.top+2*r.y;break;case"down":t._r.top=t._r.top-2*r.y;break;case"left":t._r.left=t._r.left+2*r.x;break;case"right":t._r.left=t._r.left-2*r.x}return t}function p(t,e){var r=f(t,e);return{x:r*e.x,y:r*e.y}}e.nil=n,e.vec=i,e.dist1=o,e.distp=u,e.norm1=c,e.norm2=a,e.opp=s,e.dot=f,e.pointReflect=l,e.axisReflect=d,Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,r){"use strict";e["default"]=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},e.__esModule=!0},function(t,e,r){"use strict";function n(t,e){if(t){var r=_.extend({},t.getBoundingClientRect());return r.height>0||r.width>0?(e&&(r.height=r.height-2*e,r.width=r.width-2*e,r.top=r.top+e,r.left=r.left+e,r.right=r.right-e,r.bottom=r.bottom-e),new s(t,r)):void 0}}var i=r(2)["default"],o=r(6)["default"];e.createBox=n,Object.defineProperty(e,"__esModule",{value:!0});var u=r(1),c=u.vec,a=u.dot,s=e.Box=function(){function t(e,r){i(this,t),this.el=e,this._r=r}return o(t,{contains:{value:function(t,e){var r=this.center(),n=c(r,this.bound(e.down)),i=c(r,this.bound(e.right)),o=c(r,t);return 2*Math.abs(a(n,o))<=this._r.height&&2*Math.abs(a(i,o))<=this._r.width}},center:{value:function(){return{x:this._r.left+this._r.width/2,y:this._r.top+this._r.height/2}}},bound:{value:function(t){return{x:this._r.left+this._r.width*(1+t.x)/2,y:this._r.top+this._r.height*(1+t.y)/2}}}}),t}()},function(t,e,r){"use strict";function n(t,e){var r;return null!=window.MutationObserver?(r=new MutationObserver(e),r.observe(t,{attributes:!1,childList:!0,characterData:!0,subtree:!0})):(e=_.debounce(e,0),t.addEventListener("DOMSubtreeModified",e),r={disconnect:function(){t.removeEventListener("DOMSubtreeModified",e)}}),r}e.DOMObserver=n,Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,r){"use strict";function n(t,e){return t.querySelector(e)}function i(t,e){return _.toArray(t.querySelectorAll(e))}function o(t,e,r){t&&r!==!1&&t.classList.add(e)}function u(t,e,r){t&&r!==!1&&t.classList.remove(e)}e.$first=n,e.$find=i,e.$addClass=o,e.$rmvClass=u,Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,r){"use strict";e["default"]=function(){function t(t,e){for(var r in e){var n=e[r];n.configurable=!0,n.value&&(n.writable=!0)}Object.defineProperties(t,e)}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),e.__esModule=!0}])});