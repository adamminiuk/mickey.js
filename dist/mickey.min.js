!function(t,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):"object"==typeof exports?exports.Mickey=r():t.Mickey=r()}(this,function(){return function(t){function r(n){if(e[n])return e[n].exports;var i=e[n]={exports:{},id:n,loaded:!1};return t[n].call(i.exports,i,i.exports,r),i.loaded=!0,i.exports}var e={};return r.m=t,r.c=e,r.p="",r(0)}([function(t,r,e){"use strict";function n(t){var r=function(r){var e=C[r.keyCode];"click"===e?t.click():e&&t.move(e)};return{bind:_.bind(document.addEventListener,document,"keydown",r),unbind:_.bind(document.removeEventListener,document,"keydown",r)}}function i(t,r){return function(e){return e.hasAttribute("data-"+t)?r:0}}function o(t,r){function e(t,r){if(t){var e=document.createEvent("MouseEvents"),n=J.pos.x,i=J.pos.y;e.initMouseEvent(r,!0,!0,window,0,n,i,n,i,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}function i(r){return!!r&&(r.hasAttribute("data-nav-area")||r===t)}function o(t){return!!t&&t.hasAttribute("data-nav-limit")}function u(t){return!!t&&t.hasAttribute("data-nav-track")}function C(t,r){if(!t||!t.hasAttribute("data-nav-circular"))return!1;var e=t.dataset.navCircular;return""===e||M[r]===e}function B(t,r){return!!r&&o(t)&&t.dataset.navLimit===E[r]}function L(t){return!!t&&t.hasAttribute("data-nav-selected")}function S(t,r,e){return 0!==e.y?!(r.left>=t.left+t.width||r.left+r.width<=t.left):0!==e.x?!(r.top>=t.top+t.height||r.top+r.height<=t.top):!1}function O(t,e,n,i){var o=n?g[n]:x(),a=y(o),u=t._r;t instanceof c&&(t=t.bound(o));var f=function(e){return v(h(t,e),o)>=-r.overlap},l=_.sortBy(_.map(_.filter(_.map(e,s),function(t){return t&&f(i?t.bound(a):t.center())}),function(e){var n=e.bound(a),i={el:e.el,proj:k(t,e.bound(a),o),dist:b(t,n),priority:1/0};return u&&S(u,e._r,o)?(0!==o.y&&(_.contains(r.priority,"left")&&(i.priority=n.x),_.contains(r.priority,"right")&&(i.priority=-n.x)),0!==o.x&&(_.contains(r.priority,"top")&&(i.priority=n.y),_.contains(r.priority,"bottom")&&(i.priority=-n.y)),i):i}),["proj","priority","dist"]);return l.length>1&&_.find(l,function(t){return t.priority<1/0})&&(l=_.filter(l,function(t){return t.priority<1/0})),l[0]&&l[0].el}function j(t,r){var e=s(O(t,r));return e&&e.contains(t,g)?e.el:void 0}function I(){var e=l(t,r.$area);return e.length?e:[t]}function R(){var t=I();return _.some(t,L)&&(t=_.sortBy(t,$)),_.first(t)}function q(t,e){var n=l(t,t.dataset.navArea||r.$href),i=_.some(n,o);return i&&(n=_.sortBy(n,A)),i&&e?_.filter(n,function(t){return!o(t)||B(t,e)}):n}function D(t){return J.focus(J.closest()||R(),t,!0)}if(!t)throw new Error("mickey: should pass a parent DOM element");var z=!1,N=!1;r=_.defaults(r||{},{hoverClass:"hover",areaClass:"hover",trackClass:"tracked",overlap:0,position:null,priority:"left,top",listener:n,observer:a,$area:"[data-nav-area]",$href:null});var P,J={version:"1.0.4",pos:r.position||x(),el:null,ar:null},T=r.listener(J),Z=_.once(function(){P=r.observer(t,G),T.bind&&T.bind(t)}),F=_.once(function(){P&&P.disconnect(),T.unbind&&T.unbind()});J.focus=function(n,a,c){if(_.isString(n)&&(n=t.querySelector(n)),i(n))return J.focus(J.defaults(n));var f=s(n);if(!f)return!1;var l=n,v=J.area(l),h=J.el,y=J.ar,x=o(l),b=v!==y;return b&&(J.ar=v,d(y,r.areaClass),p(v,r.areaClass)),l===h||v===y&&x&&!c||(J.pos=f.center(),J.el=l,d(h,r.hoverClass),p(h,r.trackClass,b&&u(y)),e(h,"mouseout"),e(l,"mouseover")),d(l,r.trackClass),p(l,r.hoverClass,!x),x&&B(l,a)&&J.click(n),N||(N=!0),!0},J.position=function(){return{x:J.pos.x,y:J.pos.y}},J.move=function(t){if(z)throw new Error("mickey: locked");var e=J.el,n=s(e);if(n){var i=J.area(),o=_.without(q(i,t),e),a=O(n,o,t);if(a)return J.focus(a,t);var c=+i.dataset.navZIndex;if(!(c>0)){if(C(i,t))return J.focus(J.circular(t));var l=s(i),d=_.without(I(),i),p=O(l,d,t,!0);if(!p)return B(J.el,t)?J.click():!1;var v=q(p);if(1===v.length&&B(v[0],t))return J.click(v[0]);if(u(i)&&(i.dataset.navTrackPos=JSON.stringify(J.pos)),u(p)){var h=p.dataset.navTrackPos,y=f(p,"."+r.trackClass);a=y||h&&O(JSON.parse(h),v)}return J.focus(a||v[0],t)}}else if(!D(t))throw new Error("mickey: cannot move")},J.click=function(r){if(z||!N)throw new Error("mickey: locked");if(r=r||J.el,!t.contains(r,g))throw new Error("mickey: cannot click on non visible element");if(!r&&!D())throw new Error("mickey: cannot click");return e(r,"click"),!0},J.area=function(r){for(r=r||J.el;r&&r!==t;)if(r=r.parentNode,i(r))return r;return t},J.closest=function(t){var r=_.flatten(_.map(t?[t]:I(),q));return O(J.pos,r)},J.closestInArea=function(){return J.closest(J.ar)},J.defaults=function(t){return q(t||R())[0]},J.defaultsInArea=function(){return J.defaults(J.ar)},J.hovered=function(){var t=_.flatten(_.map(I(),q));return j(J.pos,t)},J.circular=function(t){var r,e=s(J.ar).center();return r=t?m(s(J.el),t,e):w(J.pos,e),O(r,q(J.ar),t)},J.block=function(){z=!0,p(J.el,"blocked")},J.unblock=function(){z=!1,d(J.el,"blocked")},J.clear=_.once(function(){F(),J.pos=x(),J.el=null,J.ar=null,t=null,z=!1,T=null}),J.update=function(){J.focus(J.closest())},J.init=function(){if(N)throw new Error("mickey: already initialized");return Z(),J.focus(r.position?J.hovered():J.defaults()),J};var G=function(){if(!N)return J.init();if(t&&!t.contains(J.el,g)){var r,e=J.ar;switch(e.dataset.navPolicy){default:case"closest":r=J.closestInArea();break;case"defaults":r=J.defaultsInArea();break;case"hovered":r=J.hovered();break;case"circular":r=J.circular()}J.focus(r,null,!0)}};return J}var a=e(3),u=e(2),c=u.Box,s=u.createBox,u=e(4),f=u.$first,l=u.$find,d=u.$rmvClass,p=u.$addClass,u=e(1),v=u.dot,h=u.vec,y=u.opp,x=u.nil,b=u.dist1,k=u.distp,m=u.axisReflect,w=u.pointReflect,g={left:{x:-1,y:0},up:{x:0,y:-1},right:{x:1,y:0},down:{x:0,y:1}},C={37:"left",38:"up",39:"right",40:"down",13:"click"},E={left:"left",up:"top",right:"right",down:"bottom"},M={left:"horizontal",right:"horizontal",up:"vertical",down:"vertical"},A=i("nav-limit",1),$=i("nav-selected",-1);t.exports=o},function(t){"use strict";function r(){return{x:0,y:0}}function e(t,r){return{x:r.x-t.x,y:r.y-t.y}}function n(t,r){return o(e(t,r))}function i(t,r,n){return o(f(e(t,r),n))}function o(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function a(t){return{x:-t.x,y:-t.y}}function u(t,r){return t.x*r.x+t.y*r.y}function c(t,r){return{x:2*r.x-t.x,y:2*r.y-t.y}}function s(t,r,e){var n=_.extend({},t._r);switch(r){case"up":n.top=n.top+2*e.y;break;case"down":n.top=n.top-2*e.y;break;case"left":n.left=n.left+2*e.x;break;case"right":n.left=n.left-2*e.x}return t._r=n,t}function f(t,r){var e=u(t,r);return{x:e*r.x,y:e*r.y}}t.exports={nil:r,vec:e,dist1:n,distp:i,norm1:o,opp:a,dot:u,pointReflect:c,axisReflect:s}},function(t,r,e){"use strict";function n(t){if(t){var r=t.getBoundingClientRect();return r.height>0||r.width>0?new i(t,r):void 0}}function i(t,r){this.el=t,this._r=r}var o=e(1),a=o.vec,u=o.dot;i.prototype.contains=function(t,r){var e=this.center(),n=a(e,this.bound(r.down)),i=a(e,this.bound(r.right)),o=a(e,t);return 2*Math.abs(u(n,o))<=this._r.height&&2*Math.abs(u(i,o))<=this._r.width},i.prototype.center=function(){return{x:this._r.left+this._r.width/2,y:this._r.top+this._r.height/2}},i.prototype.bound=function(t){return{x:this._r.left+this._r.width*(1+t.x)/2,y:this._r.top+this._r.height*(1+t.y)/2}},t.exports={Box:i,createBox:n}},function(t){"use strict";t.exports=function(t,r){var e;return null!=window.MutationObserver?(e=new MutationObserver(r),e.observe(t,{attributes:!1,childList:!0,characterData:!0,subtree:!0})):(r=_.debounce(r,0),t.addEventListener("DOMSubtreeModified",r),e={disconnect:function(){t.removeEventListener("DOMSubtreeModified",r)}}),e}},function(t){"use strict";function r(t,r){return t.querySelector(r)}function e(t,r){return _.toArray(t.querySelectorAll(r))}function n(t,r,e){t&&e!==!1&&t.classList.add(r)}function i(t,r,e){t&&e!==!1&&t.classList.remove(r)}t.exports={$first:r,$find:e,$addClass:n,$rmvClass:i}}])});