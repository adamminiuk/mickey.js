!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):"object"==typeof exports?exports.Mickey=n():t.Mickey=n()}(this,function(){return function(t){function n(r){if(e[r])return e[r].exports;var o=e[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}var e={};return n.m=t,n.c=e,n.p="",n(0)}([function(t,n,e){"use strict";function r(t){var n=function(n){var e=C[n.keyCode];"click"===e?t.click():e&&t.move(e)};return{bind:_.bind(document.addEventListener,document,"keydown",n),unbind:_.bind(document.removeEventListener,document,"keydown",n)}}function o(t,n){return function(e){return e.hasAttribute("data-"+t)?n:0}}function i(t,n){function e(t,n){if(t){var e=document.createEvent("MouseEvents"),r=P.pos.x,o=P.pos.y;e.initMouseEvent(n,!0,!0,window,0,r,o,r,o,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}function o(n){return!!n&&(n.hasAttribute("data-nav-area")||n===t)}function i(t){return!!t&&t.hasAttribute("data-nav-limit")}function u(t){return!!t&&t.hasAttribute("data-nav-track")}function C(t,n){if(!t||!t.hasAttribute("data-nav-circular"))return!1;var e=t.dataset.navCircular;return""===e||E[n]===e}function B(t,n){return!!n&&i(t)&&t.dataset.navLimit===M[n]}function L(t){return!!t&&t.hasAttribute("data-nav-selected")}function S(t,e,r,o){var i=r?g[r]:b(),a=y(i);t instanceof c&&(t=t.bound(i));var u=function(e){return h(p(t,e),i)>=-n.overlap},f=_.sortBy(_.map(_.filter(_.map(e,s),function(t){return t&&u(o?t.bound(a):t.center())}),function(n){return{el:n.el,proj:k(t,n.bound(a),i),dist:x(t,n.bound(a))}}),function(t){return t.proj});return f.length>1&&f[0].proj===f[1].proj&&(f=_.sortBy(f,function(t){return t.dist})),f[0]&&f[0].el}function j(t,n){var e=s(S(t,n));return e&&e.contains(t,g)?e.el:void 0}function O(){var e=l(t,n.$area);return e.length?e:[t]}function I(){var t=O();return _.some(t,L)&&(t=_.sortBy(t,$)),_.first(t)}function R(t,e){var r=l(t,t.dataset.navArea||n.$href),o=_.some(r,i);return o&&(r=_.sortBy(r,A)),o&&e?_.filter(r,function(t){return!i(t)||B(t,e)}):r}function D(t){return P.focus(P.closest()||I(),t,!0)}if(!t)throw new Error("mickey: should pass a parent DOM element");var q=!1,z=!1;n=_.defaults(n||{},{hoverClass:"hover",areaClass:"hover",trackClass:"tracked",overlap:0,position:null,listener:r,observer:a,$area:"[data-nav-area]",$href:null});var N,P={version:"1.0.4",pos:n.position||b(),el:null,ar:null},J=n.listener(P),T=_.once(function(){N=n.observer(t,F),J.bind&&J.bind(t)}),Z=_.once(function(){N&&N.disconnect(),J.unbind&&J.unbind()});P.focus=function(r,a,c){if(_.isString(r)&&(r=t.querySelector(r)),o(r))return P.focus(P.defaults(r));var f=s(r);if(!f)return!1;var l=r,h=P.area(l),p=P.el,y=P.ar,b=i(l),x=h!==y;return x&&(P.ar=h,d(y,n.areaClass),v(h,n.areaClass)),l===p||h===y&&b&&!c||(P.pos=f.center(),P.el=l,d(p,n.hoverClass),v(p,n.trackClass,x&&u(y)),e(p,"mouseout"),e(l,"mouseover")),d(l,n.trackClass),v(l,n.hoverClass,!b),b&&B(l,a)&&P.click(r),z||(z=!0),!0},P.position=function(){return{x:P.pos.x,y:P.pos.y}},P.move=function(t){if(q)throw new Error("mickey: locked");var e=P.el,r=s(e);if(r){var o=P.area(),i=_.without(R(o,t),e),a=S(r,i,t);if(a)return P.focus(a,t);var c=+o.dataset.navZIndex;if(!(c>0)){if(C(o,t))return P.focus(P.circular(t));var l=s(o),d=_.without(O(),o),v=S(l,d,t,!0);if(!v)return B(P.el,t)?P.click():!1;var h=R(v);if(1===h.length&&B(h[0],t))return P.click(h[0]);if(u(o)&&(o.dataset.navTrackPos=JSON.stringify(P.pos)),u(v)){var p=v.dataset.navTrackPos,y=f(v,"."+n.trackClass);a=y||p&&S(JSON.parse(p),h)}return P.focus(a||h[0],t)}}else if(!D(t))throw new Error("mickey: cannot move")},P.click=function(n){if(q||!z)throw new Error("mickey: locked");if(n=n||P.el,!t.contains(n,g))throw new Error("mickey: cannot click on non visible element");if(!n&&!D())throw new Error("mickey: cannot click");return e(n,"click"),!0},P.area=function(n){for(n=n||P.el;n&&n!==t;)if(n=n.parentNode,o(n))return n;return t},P.closest=function(t){var n=_.flatten(_.map(t?[t]:O(),R));return S(P.pos,n)},P.closestInArea=function(){return P.closest(P.ar)},P.defaults=function(t){return R(t||I())[0]},P.defaultsInArea=function(){return P.defaults(P.ar)},P.hovered=function(){var t=_.flatten(_.map(O(),R));return j(P.pos,t)},P.circular=function(t){var n,e=s(P.ar).center();return n=t?m(s(P.el).bound(g[t]),e,g[t]):w(P.pos,e),S(n,R(P.ar),t)},P.block=function(){q=!0,v(P.el,"blocked")},P.unblock=function(){q=!1,d(P.el,"blocked")},P.clear=_.once(function(){Z(),P.pos=b(),P.el=null,P.ar=null,t=null,q=!1,J=null}),P.update=function(){P.focus(P.closest())},P.init=function(){if(z)throw new Error("mickey: already initialized");return T(),P.focus(n.position?P.hovered():P.defaults()),P};var F=function(){if(!z)return P.init();if(t&&!t.contains(P.el,g)){var n,e=P.ar;switch(e.dataset.navPolicy){default:case"closest":n=P.closestInArea();break;case"defaults":n=P.defaultsInArea();break;case"hovered":n=P.hovered();break;case"circular":n=P.circular()}P.focus(n,null,!0)}};return P}var a=e(3),u=e(2),c=u.Box,s=u.createBox,u=e(4),f=u.$first,l=u.$find,d=u.$rmvClass,v=u.$addClass,u=e(1),h=u.dot,p=u.vec,y=u.opp,b=u.nil,x=u.dist1,k=u.distp,m=u.axisReflect,w=u.pointReflect,g={left:{x:-1,y:0},up:{x:0,y:-1},right:{x:1,y:0},down:{x:0,y:1}},C={37:"left",38:"up",39:"right",40:"down",13:"click"},M={left:"left",up:"top",right:"right",down:"bottom"},E={left:"horizontal",right:"horizontal",up:"vertical",down:"vertical"},A=o("nav-limit",1),$=o("nav-selected",-1);t.exports=i},function(t){"use strict";function n(){return{x:0,y:0}}function e(t,n){return{x:n.x-t.x,y:n.y-t.y}}function r(t,n){return i(e(t,n))}function o(t,n,r){return i(f(e(t,n),r))}function i(t){return Math.abs(t.x)+Math.abs(t.y)}function a(t){return{x:-t.x,y:-t.y}}function u(t,n){return t.x*n.x+t.y*n.y}function c(t,n){return{x:2*n.x-t.x,y:2*n.y-t.y}}function s(t,n,e){return{x:t.x+2*(n.x-t.x)*Math.abs(e.x),y:t.y+2*(n.y-t.y)*Math.abs(e.y)}}function f(t,n){var e=u(t,n);return{x:e*n.x,y:e*n.y}}t.exports={nil:n,vec:e,dist1:r,distp:o,norm1:i,opp:a,dot:u,pointReflect:c,axisReflect:s}},function(t,n,e){"use strict";function r(t){if(t){var n=t.getBoundingClientRect();return n.height>0||n.width>0?new o(t,n):void 0}}function o(t,n){this.el=t,this._r=n}var i=e(1),a=i.vec,u=i.dot;o.prototype.contains=function(t,n){var e=this.center(),r=a(e,this.bound(n.down)),o=a(e,this.bound(n.right)),i=a(e,t);return 2*Math.abs(u(r,i))<=this._r.height&&2*Math.abs(u(o,i))<=this._r.width},o.prototype.center=function(){return{x:this._r.left+this._r.width/2,y:this._r.top+this._r.height/2}},o.prototype.bound=function(t){return{x:this._r.left+this._r.width*(1+t.x)/2,y:this._r.top+this._r.height*(1+t.y)/2}},t.exports={Box:o,createBox:r}},function(t){"use strict";t.exports=function(t,n){var e;return null!=window.MutationObserver?(e=new MutationObserver(n),e.observe(t,{attributes:!1,childList:!0,characterData:!0,subtree:!0})):(n=_.debounce(n,0),t.addEventListener("DOMSubtreeModified",n),e={disconnect:function(){t.removeEventListener("DOMSubtreeModified",n)}}),e}},function(t){"use strict";function n(t,n){return t.querySelector(n)}function e(t,n){return _.toArray(t.querySelectorAll(n))}function r(t,n,e){t&&e!==!1&&t.classList.add(n)}function o(t,n,e){t&&e!==!1&&t.classList.remove(n)}t.exports={$first:n,$find:e,$addClass:r,$rmvClass:o}}])});