!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):"object"==typeof exports?exports.Mickey=e():t.Mickey=e()}(this,function(){return function(t){function e(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){"use strict";function n(t){var e=function(e){var r=C[e.keyCode];"click"===r?t.click():r&&t.move(r)};return{bind:function(){document.addEventListener("keydown",e)},unbind:function(){document.removeEventListener("keydown",e)}}}function o(t,e,r){return function(n){return n.hasAttribute(r+t)?e:0}}function i(t,e){function r(t,e){if(t){var r=document.createEvent("MouseEvents"),n=P.pos.x,o=P.pos.y;r.initMouseEvent(e,!0,!0,window,0,n,o,n,o,!1,!1,!1,!1,0,null),t.dispatchEvent(r)}}function i(e){return!!e&&(e.hasAttribute(N+"area")||e===t)}function c(t){return!!t&&t.hasAttribute(N+"limit")}function C(t){return!!t&&t.hasAttribute(N+"track")}function $(t,e){if(!t||!t.hasAttribute(N+"circular"))return!1;var r=t.getAttribute(N+"circular");return""===r||M[e]===r}function S(t,e){return!!e&&c(t)&&t.getAttribute(N+"limit")===A[e]}function E(t){return!!t&&t.hasAttribute(N+"selected")}function B(t,e,r){return 0!==r.y?!(e.left>=t.left+t.width||e.left+e.width<=t.left):0!==r.x?!(e.top>=t.top+t.height||e.top+e.height<=t.top):!1}function L(t,r,n,o){var i=n?w[n]:b(),u=y(i),c=t._r;t instanceof a&&(t=t.bound(i));var l=_.map(r,s),f=_.filter(l,function(r){if(!r)return!1;var n=o?r.bound(u):r.center(),c=v(t,n);return h(c,i)>=-e.overlap}),d=_.sortByAll(_.map(f,function(e){var r=e.bound(u),n={el:e.el,proj:k(t,e.bound(u),i),dist:x(t,r),priority:1/0};return c&&B(c,e._r,i)?(0!==i.y&&(n.priority=r.x*F),0!==i.x&&(n.priority=r.y*J),n):n}),["proj","priority","dist"]);return d.length>1&&(d=_.filter(d,function(t){return t.priority<1/0})),d[0]&&d[0].el}function O(t,e){var r=s(L(t,e));return r&&r.contains(t,w)?r.el:void 0}function j(){var r=f(t,e.$area);return r.length?r:[t]}function R(){var t=j();return _.some(t,E)&&(t=_.sortBy(t,K)),_.first(t)}function z(t,r){var n=f(t,t.getAttribute(N+"area")||e.$href),o=_.some(n,c);return o&&(n=_.sortBy(n,H)),o&&r?_.filter(n,function(t){return!c(t)||S(t,r)}):n}function D(t){return P.focus(P.closest()||R(),t,!0)}if(!t)throw new Error("mickey: should pass a parent DOM element");var I=!1,q=!1;e=_.defaults(e||{},{changeClass:!0,hoverClass:"hover",areaClass:"hover",trackClass:"tracked",onChangeArea:_.noop,onChangeSelected:_.noop,overlap:0,position:null,priority:"left,top",listener:n,observer:u,prefix:"data-nav-",$area:"[data-nav-area]",$href:null});var N=e.prefix,J=0,F=0;_.contains(e.priority,"left")&&(F=1),_.contains(e.priority,"right")&&(F=-1),_.contains(e.priority,"top")&&(J=1),_.contains(e.priority,"bottom")&&(J=-1);var G,H=o("limit",1,N),K=o("selected",-1,N),P={version:"1.0.5",pos:e.position||b(),el:null,ar:null},Q=e.listener(P),T=_.once(function(){G=e.observer(t,V),Q.bind&&Q.bind(t)}),U=_.once(function(){G&&G.disconnect(),Q.unbind&&Q.unbind()});P.focus=function(n,o,u){if(_.isString(n)&&(n=t.querySelector(n)),i(n))return P.focus(P.defaults(n));var a=s(n);if(!a)return!1;var l=n,f=P.area(l),h=P.el,v=P.ar,y=c(l),b=f!==v;return b&&(P.ar=f,e.changeClass&&(d(v,e.areaClass),p(f,e.areaClass))),l===h||f===v&&y&&!u||(P.pos=a.center(),P.el=l,e.changeClass&&(d(h,e.hoverClass),p(h,e.trackClass,b&&C(v))),r(h,"mouseout"),r(l,"mouseover")),e.changeClass&&(d(l,e.trackClass),p(l,e.hoverClass,!y)),y&&S(l,o)&&P.click(n),P.ar!==v&&e.onChangeArea(v,P.ar),P.el!==h&&e.onChangeSelected(h,P.el,P.ar),q||(q=!0),!0},P.position=function(){return{x:P.pos.x,y:P.pos.y}},P.move=function(t){if(I)return void console.warn("mickey: locked");var r=P.el,n=s(r);if(!n)return void(D(t)||console.warn("mickey: cannot move"));var o=P.area(),i=_.without(z(o,t),r),u=L(n,i,t);if(u)return P.focus(u,t);var c=+o.getAttribute(N+"z-index");if(!(c>0)){if($(o,t))return P.focus(P.circular(t));var a=s(o),f=_.without(j(),o),d=L(a,f,t,!0);if(!d)return S(P.el,t)?P.click():!1;var p=z(d);if(1===p.length&&S(p[0],t))return P.click(p[0]);if(C(o)&&o.setAttribute(N+"track-pos",JSON.stringify(P.pos)),C(d)){var h=d.getAttribute(N+"track-pos"),v=l(d,"."+e.trackClass);u=v||h&&L(JSON.parse(h),p)}return P.focus(u||p[0],t)}},P.click=function(e){return I||!q?void console.warn("mickey: locked"):(e=e||P.el,t.contains(e,w)?e||D()?(r(e,"click"),!0):void console.warn("mickey: cannot click"):void console.warn("mickey: cannot click on non visible element"))},P.area=function(e){for(e=e||P.el;e&&e!==t;)if(e=e.parentNode,i(e))return e;return t},P.closest=function(t){var e=_.flatten(_.map(t?[t]:j(),z));return L(P.pos,e)},P.closestInArea=function(){return P.closest(P.ar)},P.defaults=function(t){return z(t||R())[0]},P.defaultsInArea=function(){return P.defaults(P.ar)},P.hovered=function(){var t=_.flatten(_.map(j(),z));return O(P.pos,t)},P.circular=function(t){var e,r=s(P.ar).center();return e=t?g(s(P.el),t,r):m(P.pos,r),L(e,z(P.ar),t)},P.block=function(){I=!0,e.changeClass&&p(P.el,"blocked")},P.unblock=function(){I=!1,e.changeClass&&d(P.el,"blocked")},P.clear=_.once(function(){U(),P.pos=b(),P.el=null,P.ar=null,t=null,I=!1,Q=null}),P.update=function(){P.focus(P.closest())},P.init=function(){return q?void console.warn("mickey: already initialized"):(T(),P.focus(e.position?P.hovered():P.defaults()),P)};var V=function(){if(!q)return P.init();if(t&&!t.contains(P.el,w)){var e,r=P.ar;switch(r.getAttribute(N+"policy")){default:case"closest":e=P.closestInArea();break;case"defaults":e=P.defaultsInArea();break;case"hovered":e=P.hovered();break;case"circular":e=P.circular()}P.focus(e,null,!0)}};return P}var u=r(3),c=r(2),a=c.Box,s=c.createBox,c=r(4),l=c.$first,f=c.$find,d=c.$rmvClass,p=c.$addClass,c=r(1),h=c.dot,v=c.vec,y=c.opp,b=c.nil,x=c.dist1,k=c.distp,g=c.axisReflect,m=c.pointReflect,w={left:{x:-1,y:0},up:{x:0,y:-1},right:{x:1,y:0},down:{x:0,y:1}},C={37:"left",38:"up",39:"right",40:"down",13:"click"},A={left:"left",up:"top",right:"right",down:"bottom"},M={left:"horizontal",right:"horizontal",up:"vertical",down:"vertical"};t.exports=i},function(t){"use strict";function e(){return{x:0,y:0}}function r(t,e){return{x:e.x-t.x,y:e.y-t.y}}function n(t,e){return i(r(t,e))}function o(t,e,n){return i(l(r(t,e),n))}function i(t){return Math.abs(t.x)+Math.abs(t.y)}function u(t){return{x:-t.x,y:-t.y}}function c(t,e){return t.x*e.x+t.y*e.y}function a(t,e){return{x:2*e.x-t.x,y:2*e.y-t.y}}function s(t,e,r){var n=_.extend({},t._r);switch(e){case"up":n.top=n.top+2*r.y;break;case"down":n.top=n.top-2*r.y;break;case"left":n.left=n.left+2*r.x;break;case"right":n.left=n.left-2*r.x}return t._r=n,t}function l(t,e){var r=c(t,e);return{x:r*e.x,y:r*e.y}}t.exports={nil:e,vec:r,dist1:n,distp:o,norm1:i,opp:u,dot:c,pointReflect:a,axisReflect:s}},function(t,e,r){"use strict";function n(t){if(t){var e=t.getBoundingClientRect(),r=e.height,n=e.width;if(0!==r||0!==n)return new o(t,{height:r,width:n,top:e.top,right:e.right,bottom:e.bottom,left:e.left})}}function o(t,e){this.el=t,this._r=e}var i=r(1),u=i.vec,c=i.dot;o.prototype.contains=function(t,e){var r=this.center(),n=u(r,this.bound(e.down)),o=u(r,this.bound(e.right)),i=u(r,t);return 2*Math.abs(c(n,i))<=this._r.height&&2*Math.abs(c(o,i))<=this._r.width},o.prototype.center=function(){return{x:this._r.left+this._r.width/2,y:this._r.top+this._r.height/2}},o.prototype.bound=function(t){return{x:this._r.left+this._r.width*(1+t.x)/2,y:this._r.top+this._r.height*(1+t.y)/2}},t.exports={Box:o,createBox:n}},function(t){"use strict";t.exports=function(t,e){var r;return null!=window.MutationObserver?(r=new MutationObserver(e),r.observe(t,{attributes:!1,childList:!0,characterData:!0,subtree:!0})):(e=_.debounce(e,0),t.addEventListener("DOMSubtreeModified",e),r={disconnect:function(){t.removeEventListener("DOMSubtreeModified",e)}}),r}},function(t){"use strict";function e(t,e){return t.querySelector(e)}function r(t,e){return _.toArray(t.querySelectorAll(e))}function n(t,e,r){t&&r!==!1&&t.classList.add(e)}function o(t,e,r){t&&r!==!1&&t.classList.remove(e)}t.exports={$first:e,$find:r,$addClass:n,$rmvClass:o}}])});