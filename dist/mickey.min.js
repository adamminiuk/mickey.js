!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):"object"==typeof exports?exports.Mickey=n():t.Mickey=n()}(this,function(){return function(t){function n(r){if(e[r])return e[r].exports;var o=e[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}var e={};return n.m=t,n.c=e,n.p="",n(0)}([function(t,n,e){"use strict";function r(t){var n=function(n){var e=g[n.keyCode];"click"===e?t.click():e&&t.move(e)};return{bind:_.bind(document.addEventListener,document,"keydown",n),unbind:_.bind(document.removeEventListener,document,"keydown",n)}}function o(t,n){return function(e){return null==e.dataset[t]?0:n}}function i(t,n){function e(t,n){if(t){var e=document.createEvent("MouseEvents"),r=P.pos.x,o=P.pos.y;e.initMouseEvent(n,!0,!0,window,0,r,o,r,o,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}function o(n){return!!n&&(null!=n.dataset.navArea||n===t)}function i(t){return!!t&&null!=t.dataset.navLimit}function a(t){return!!t&&null!=t.dataset.navTrack}function g(t,n){if(!t||null==t.dataset.navCircular)return!1;var e=t.dataset.navCircular;return""===e||E[n]===e}function S(t,n){return!!n&&i(t)&&t.dataset.navLimit===M[n]}function B(t){return!!t&&null!=t.dataset.navSelected}function A(t,e,r,o){var i=r?C[r]:x(),u=y(i);t instanceof c&&(t=t.bound(i));var a=function(e){return p(h(t,e),i)>=-n.overlap},l=_.sortBy(_.map(_.filter(_.map(e,s),function(t){return t&&a(o?t.bound(u):t.center())}),function(n){return{el:n.el,proj:k(t,n.bound(u),i),dist:b(t,n.bound(u))}}),function(t){return t.proj});return l.length>1&&l[0].proj===l[1].proj&&(l=_.sortBy(l,function(t){return t.dist})),l[0]&&l[0].el}function j(t,n){var e=s(A(t,n));return e&&e.contains(t,C)?e.el:void 0}function O(){var e=f(t,n.$area);return e.length?e:[t]}function I(){var t=O();return _.some(t,B)&&(t=_.sortBy(t,L)),_.first(t)}function R(t,e){var r=f(t,t.dataset.navArea||n.$href),o=_.some(r,i);return o&&(r=_.sortBy(r,$)),o&&e?_.filter(r,function(t){return!i(t)||S(t,e)}):r}function D(t){return P.focus(P.closest()||I(),t,!0)}if(!t)throw new Error("mickey: should pass a parent DOM element");var q=!1,z=!1;n=_.defaults(n||{},{hoverClass:"hover",areaClass:"hover",trackClass:"tracked",overlap:0,position:null,listener:r,observer:u,$area:"[data-nav-area]",$href:null});var N,P={version:"1.0.1",pos:n.position||x(),el:null,ar:null},T=n.listener(P),J=_.once(function(){N=n.observer(t,F),T.bind&&T.bind(t)}),Z=_.once(function(){N&&N.disconnect(),T.unbind&&T.unbind()});P.focus=function(r,u,c){if(_.isString(r)&&(r=t.querySelector(r)),o(r))return P.focus(P.defaults(r));var l=s(r);if(!l)return!1;var f=r,p=P.area(f),h=P.el,y=P.ar,x=i(f),b=p!==y;return b&&(P.ar=p,d(y,n.areaClass),v(p,n.areaClass)),f===h||p===y&&x&&!c||(P.pos=l.center(),P.el=f,d(h,n.hoverClass),v(h,n.trackClass,b&&a(y)),e(h,"mouseout"),e(f,"mouseover")),d(f,n.trackClass),v(f,n.hoverClass,!x),x&&S(f,u)&&P.click(r),z||(z=!0),!0},P.position=function(){return{x:P.pos.x,y:P.pos.y}},P.move=function(t){if(q)throw new Error("mickey: locked");var e=P.el,r=s(e);if(r){var o=P.area(),i=_.without(R(o,t),e),u=A(r,i,t);if(u)return P.focus(u,t);var c=+o.dataset.navZIndex;if(!(c>0)){if(g(o,t))return P.focus(P.circular(t));var f=s(o),d=_.without(O(),o),v=A(f,d,t,!0);if(!v)return S(P.el,t)?P.click():!1;var p=R(v);if(1===p.length&&S(p[0],t))return P.click(p[0]);if(a(o)&&(o.dataset.navTrackPos=JSON.stringify(P.pos)),a(v)){var h=v.dataset.navTrackPos,y=l(v,"."+n.trackClass);u=y||h&&A(JSON.parse(h),p)}return P.focus(u||p[0],t)}}else if(!D(t))throw new Error("mickey: cannot move")},P.click=function(n){if(q||!z)throw new Error("mickey: locked");if(n=n||P.el,!t.contains(n,C))throw new Error("mickey: cannot click on non visible element");if(!n&&!D())throw new Error("mickey: cannot click");return e(n,"click"),!0},P.area=function(n){for(n=n||P.el;n&&n!==t;)if(n=n.parentNode,o(n))return n;return t},P.closest=function(t){var n=_.flatten(_.map(t?[t]:O(),R));return A(P.pos,n)},P.closestInArea=function(){return P.closest(P.ar)},P.defaults=function(t){return R(t||I())[0]},P.defaultsInArea=function(){return P.defaults(P.ar)},P.hovered=function(){var t=_.flatten(_.map(O(),R));return j(P.pos,t)},P.circular=function(t){var n,e=s(P.ar).center();return n=t?m(s(P.el).bound(C[t]),e,C[t]):w(P.pos,e),A(n,R(P.ar),t)},P.block=function(){q=!0,v(P.el,"blocked")},P.unblock=function(){q=!1,d(P.el,"blocked")},P.clear=_.once(function(){Z(),P.pos=x(),P.el=null,P.ar=null,t=null,q=!1,T=null}),P.update=function(){P.focus(P.closest())},P.init=function(){if(z)throw new Error("mickey: already initialized");return J(),P.focus(n.position?P.hovered():P.defaults()),P};var F=function(){if(!z)return P.init();if(t&&!t.contains(P.el,C)){var n,e=P.ar;switch(e.dataset.navPolicy){default:case"closest":n=P.closestInArea();break;case"defaults":n=P.defaultsInArea();break;case"hovered":n=P.hovered();break;case"circular":n=P.circular()}P.focus(n,null,!0)}};return P}var u=e(3),a=e(2),c=a.Box,s=a.createBox,a=e(4),l=a.$first,f=a.$find,d=a.$rmvClass,v=a.$addClass,a=e(1),p=a.dot,h=a.vec,y=a.opp,x=a.nil,b=a.dist1,k=a.distp,m=a.axisReflect,w=a.pointReflect,C={left:{x:-1,y:0},up:{x:0,y:-1},right:{x:1,y:0},down:{x:0,y:1}},g={37:"left",38:"up",39:"right",40:"down",13:"click"},M={left:"left",up:"top",right:"right",down:"bottom"},E={left:"horizontal",right:"horizontal",up:"vertical",down:"vertical"},$=o("navLimit",1),L=o("navSelected",-1);t.exports=i},function(t){"use strict";function n(){return{x:0,y:0}}function e(t,n){return{x:n.x-t.x,y:n.y-t.y}}function r(t,n){return i(e(t,n))}function o(t,n,r){return i(l(e(t,n),r))}function i(t){return Math.abs(t.x)+Math.abs(t.y)}function u(t){return{x:-t.x,y:-t.y}}function a(t,n){return t.x*n.x+t.y*n.y}function c(t,n){return{x:2*n.x-t.x,y:2*n.y-t.y}}function s(t,n,e){return{x:t.x+2*(n.x-t.x)*Math.abs(e.x),y:t.y+2*(n.y-t.y)*Math.abs(e.y)}}function l(t,n){var e=a(t,n);return{x:e*n.x,y:e*n.y}}t.exports={nil:n,vec:e,dist1:r,distp:o,norm1:i,opp:u,dot:a,pointReflect:c,axisReflect:s}},function(t,n,e){"use strict";function r(t){if(t){var n=t.getBoundingClientRect();return n.height>0||n.width>0?new o(t,n):void 0}}function o(t,n){this.el=t,this._r=n}var i=e(1),u=i.vec,a=i.dot;o.prototype.contains=function(t,n){var e=this.center(),r=u(e,this.bound(n.down)),o=u(e,this.bound(n.right)),i=u(e,t);return 2*Math.abs(a(r,i))<=this._r.height&&2*Math.abs(a(o,i))<=this._r.width},o.prototype.center=function(){return{x:this._r.left+this._r.width/2,y:this._r.top+this._r.height/2}},o.prototype.bound=function(t){return{x:this._r.left+this._r.width*(1+t.x)/2,y:this._r.top+this._r.height*(1+t.y)/2}},t.exports={Box:o,createBox:r}},function(t){"use strict";t.exports=function(t,n){var e;return null!=window.MutationObserver?(e=new MutationObserver(n),e.observe(t,{attributes:!1,childList:!0,characterData:!0,subtree:!0})):(n=_.debounce(n,0),t.addEventListener("DOMSubtreeModified",n),e={disconnect:function(){t.removeEventListener("DOMSubtreeModified",n)}}),e}},function(t){"use strict";function n(t,n){return t.querySelector(n)}function e(t,n){return _.toArray(t.querySelectorAll(n))}function r(t,n,e){t&&e!==!1&&t.classList.add(n)}function o(t,n,e){t&&e!==!1&&t.classList.remove(n)}t.exports={$first:n,$find:e,$addClass:r,$rmvClass:o}}])});