!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):"object"==typeof exports?exports.Mickey=e():t.Mickey=e()}(this,function(){return function(t){function e(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return t[n].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){"use strict";function n(t){var e=function(e){var r=A[e.keyCode];"click"===r?t.click():r&&t.move(r)};return{bind:_.bind(document.addEventListener,document,"keydown",e),unbind:_.bind(document.removeEventListener,document,"keydown",e)}}function i(t,e,r){return function(n){return n.hasAttribute(r+t)?e:0}}function o(t,e){function r(t,e){if(t){var r=document.createEvent("MouseEvents"),n=P.pos.x,i=P.pos.y;r.initMouseEvent(e,!0,!0,window,0,n,i,n,i,!1,!1,!1,!1,0,null),t.dispatchEvent(r)}}function o(e){return!!e&&(e.hasAttribute(N+"area")||e===t)}function c(t){return!!t&&t.hasAttribute(N+"limit")}function A(t){return!!t&&t.hasAttribute(N+"track")}function M(t,e){if(!t||!t.hasAttribute(N+"circular"))return!1;var r=t.getAttribute(N+"circular");return""===r||E[e]===r}function $(t,e){return!!e&&c(t)&&t.getAttribute(N+"limit")===C[e]}function S(t){return!!t&&t.hasAttribute(N+"selected")}function B(t,e,r){return 0!==r.y?!(e.left>=t.left+t.width||e.left+e.width<=t.left):0!==r.x?!(e.top>=t.top+t.height||e.top+e.height<=t.top):!1}function L(t,r,n,i){var o=n?g[n]:b(),u=y(o),c=t._r;t instanceof a&&(t=t.bound(o));var l=_.map(r,s),f=_.filter(l,function(r){if(!r)return!1;var n=i?r.bound(u):r.center(),c=v(t,n);return h(c,o)>=-e.overlap}),d=_.sortByAll(_.map(f,function(e){var r=e.bound(u),n={el:e.el,proj:k(t,e.bound(u),o),dist:x(t,r),priority:1/0};return c&&B(c,e._r,o)?(0!==o.y&&(n.priority=r.x*F),0!==o.x&&(n.priority=r.y*J),n):n}),["proj","priority","dist"]);return d.length>1&&(d=_.filter(d,function(t){return t.priority<1/0})),d[0]&&d[0].el}function O(t,e){var r=s(L(t,e));return r&&r.contains(t,g)?r.el:void 0}function j(){var r=f(t,e.$area);return r.length?r:[t]}function R(){var t=j();return _.some(t,S)&&(t=_.sortBy(t,K)),_.first(t)}function z(t,r){var n=f(t,t.getAttribute(N+"area")||e.$href),i=_.some(n,c);return i&&(n=_.sortBy(n,H)),i&&r?_.filter(n,function(t){return!c(t)||$(t,r)}):n}function D(t){return P.focus(P.closest()||R(),t,!0)}if(!t)throw new Error("mickey: should pass a parent DOM element");var I=!1,q=!1;e=_.defaults(e||{},{hoverClass:"hover",areaClass:"hover",trackClass:"tracked",onChangeArea:_.noop,onChangeSelected:_.noop,overlap:0,position:null,priority:"left,top",listener:n,observer:u,prefix:"data-nav-",$area:"[data-nav-area]",$href:null});var N=e.prefix,J=0,F=0;_.contains(e.priority,"left")&&(F=1),_.contains(e.priority,"right")&&(F=-1),_.contains(e.priority,"top")&&(J=1),_.contains(e.priority,"bottom")&&(J=-1);var G,H=i("limit",1,N),K=i("selected",-1,N),P={version:"1.0.5",pos:e.position||b(),el:null,ar:null},Q=e.listener(P),T=_.once(function(){G=e.observer(t,V),Q.bind&&Q.bind(t)}),U=_.once(function(){G&&G.disconnect(),Q.unbind&&Q.unbind()});P.focus=function(n,i,u){if(_.isString(n)&&(n=t.querySelector(n)),o(n))return P.focus(P.defaults(n));var a=s(n);if(!a)return!1;var l=n,f=P.area(l),h=P.el,v=P.ar,y=c(l),b=f!==v;return b&&(P.ar=f,d(v,e.areaClass),p(f,e.areaClass)),l===h||f===v&&y&&!u||(P.pos=a.center(),P.el=l,d(h,e.hoverClass),p(h,e.trackClass,b&&A(v)),r(h,"mouseout"),r(l,"mouseover")),d(l,e.trackClass),p(l,e.hoverClass,!y),y&&$(l,i)&&P.click(n),P.ar!==v&&e.onChangeArea(v,P.ar),P.el!==h&&e.onChangeSelected(h,P.el),q||(q=!0),!0},P.position=function(){return{x:P.pos.x,y:P.pos.y}},P.move=function(t){if(I)throw new Error("mickey: locked");var r=P.el,n=s(r);if(n){var i=P.area(),o=_.without(z(i,t),r),u=L(n,o,t);if(u)return P.focus(u,t);var c=+i.getAttribute(N+"z-index");if(!(c>0)){if(M(i,t))return P.focus(P.circular(t));var a=s(i),f=_.without(j(),i),d=L(a,f,t,!0);if(!d)return $(P.el,t)?P.click():!1;var p=z(d);if(1===p.length&&$(p[0],t))return P.click(p[0]);if(A(i)&&i.setAttribute(N+"track-pos",JSON.stringify(P.pos)),A(d)){var h=d.getAttribute(N+"track-pos"),v=l(d,"."+e.trackClass);u=v||h&&L(JSON.parse(h),p)}return P.focus(u||p[0],t)}}else if(!D(t))throw new Error("mickey: cannot move")},P.click=function(e){if(I||!q)throw new Error("mickey: locked");if(e=e||P.el,!t.contains(e,g))throw new Error("mickey: cannot click on non visible element");if(!e&&!D())throw new Error("mickey: cannot click");return r(e,"click"),!0},P.area=function(e){for(e=e||P.el;e&&e!==t;)if(e=e.parentNode,o(e))return e;return t},P.closest=function(t){var e=_.flatten(_.map(t?[t]:j(),z));return L(P.pos,e)},P.closestInArea=function(){return P.closest(P.ar)},P.defaults=function(t){return z(t||R())[0]},P.defaultsInArea=function(){return P.defaults(P.ar)},P.hovered=function(){var t=_.flatten(_.map(j(),z));return O(P.pos,t)},P.circular=function(t){var e,r=s(P.ar).center();return e=t?m(s(P.el),t,r):w(P.pos,r),L(e,z(P.ar),t)},P.block=function(){I=!0,p(P.el,"blocked")},P.unblock=function(){I=!1,d(P.el,"blocked")},P.clear=_.once(function(){U(),P.pos=b(),P.el=null,P.ar=null,t=null,I=!1,Q=null}),P.update=function(){P.focus(P.closest())},P.init=function(){if(q)throw new Error("mickey: already initialized");return T(),P.focus(e.position?P.hovered():P.defaults()),P};var V=function(){if(!q)return P.init();if(t&&!t.contains(P.el,g)){var e,r=P.ar;switch(r.getAttribute(N+"policy")){default:case"closest":e=P.closestInArea();break;case"defaults":e=P.defaultsInArea();break;case"hovered":e=P.hovered();break;case"circular":e=P.circular()}P.focus(e,null,!0)}};return P}var u=r(3),c=r(2),a=c.Box,s=c.createBox,c=r(4),l=c.$first,f=c.$find,d=c.$rmvClass,p=c.$addClass,c=r(1),h=c.dot,v=c.vec,y=c.opp,b=c.nil,x=c.dist1,k=c.distp,m=c.axisReflect,w=c.pointReflect,g={left:{x:-1,y:0},up:{x:0,y:-1},right:{x:1,y:0},down:{x:0,y:1}},A={37:"left",38:"up",39:"right",40:"down",13:"click"},C={left:"left",up:"top",right:"right",down:"bottom"},E={left:"horizontal",right:"horizontal",up:"vertical",down:"vertical"};t.exports=o},function(t){"use strict";function e(){return{x:0,y:0}}function r(t,e){return{x:e.x-t.x,y:e.y-t.y}}function n(t,e){return o(r(t,e))}function i(t,e,n){return o(l(r(t,e),n))}function o(t){return Math.abs(t.x)+Math.abs(t.y)}function u(t){return{x:-t.x,y:-t.y}}function c(t,e){return t.x*e.x+t.y*e.y}function a(t,e){return{x:2*e.x-t.x,y:2*e.y-t.y}}function s(t,e,r){var n=_.extend({},t._r);switch(e){case"up":n.top=n.top+2*r.y;break;case"down":n.top=n.top-2*r.y;break;case"left":n.left=n.left+2*r.x;break;case"right":n.left=n.left-2*r.x}return t._r=n,t}function l(t,e){var r=c(t,e);return{x:r*e.x,y:r*e.y}}t.exports={nil:e,vec:r,dist1:n,distp:i,norm1:o,opp:u,dot:c,pointReflect:a,axisReflect:s}},function(t,e,r){"use strict";function n(t){if(t){var e=t.getBoundingClientRect();return e.height>0||e.width>0?new i(t,e):void 0}}function i(t,e){this.el=t,this._r=e}var o=r(1),u=o.vec,c=o.dot;i.prototype.contains=function(t,e){var r=this.center(),n=u(r,this.bound(e.down)),i=u(r,this.bound(e.right)),o=u(r,t);return 2*Math.abs(c(n,o))<=this._r.height&&2*Math.abs(c(i,o))<=this._r.width},i.prototype.center=function(){return{x:this._r.left+this._r.width/2,y:this._r.top+this._r.height/2}},i.prototype.bound=function(t){return{x:this._r.left+this._r.width*(1+t.x)/2,y:this._r.top+this._r.height*(1+t.y)/2}},t.exports={Box:i,createBox:n}},function(t){"use strict";t.exports=function(t,e){var r;return null!=window.MutationObserver?(r=new MutationObserver(e),r.observe(t,{attributes:!1,childList:!0,characterData:!0,subtree:!0})):(e=_.debounce(e,0),t.addEventListener("DOMSubtreeModified",e),r={disconnect:function(){t.removeEventListener("DOMSubtreeModified",e)}}),r}},function(t){"use strict";function e(t,e){return t.querySelector(e)}function r(t,e){return _.toArray(t.querySelectorAll(e))}function n(t,e,r){t&&r!==!1&&t.classList.add(e)}function i(t,e,r){t&&r!==!1&&t.classList.remove(e)}t.exports={$first:e,$find:r,$addClass:n,$rmvClass:i}}])});